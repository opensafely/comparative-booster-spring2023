version: '3.0'

expectations:

  population_size: 1000

actions:

  ## # # # # # # # # # # # # # # # # # # # 
  ## DO NOT EDIT project.yaml DIRECTLY 
  ## This file is created by create-project.R 
  ## Edit and run create-project.R to update the project.yaml 
  ## # # # # # # # # # # # # # # # # # # # 
  ## # # # # # # # # # # # # # # # # # # # 
  ## Pre-server scripts 
  ## # # # # # # # # # # # # # # # # # # # 
  ## # # # # # # # # # # # # # # # # # # # 
  ## Extract and tidy 
  ## # # # # # # # # # # # # # # # # # # # 

  extract:
    run: ehrql:v0 generate-dataset analysis/dataset_definition.py --output output/extracts/extract.arrow
      --dummy-data-file analysis/dummydata/dummyextract.arrow
    needs: []
    outputs:
      highly_sensitive:
        arrow: output/extracts/extract.arrow

  data_process:
    run: r:latest analysis/data_process.R
    needs:
    - extract
    outputs:
      highly_sensitive:
        rds: output/data/*.rds

  data_skim:
    run: r:latest analysis/data_skim.R output/data/data_processed.rds output/data/skim
    needs:
    - data_process
    outputs:
      moderately_sensitive:
        cohort: output/data/skim/*.txt

  geography:
    run: r:latest analysis/geography.R
    needs:
    - data_process
    outputs:
      moderately_sensitive:
        png: output/geography/*.png
        csv: output/geography/*.csv

  ## # # # # # # # # # # # # # # # # # # # 
  ## Cohort: age75plus 
  ## # # # # # # # # # # # # # # # # # # # 

  data_selection_age75plus:
    run: r:latest analysis/data_selection.R age75plus
    needs:
    - data_process
    outputs:
      highly_sensitive:
        rds: output/age75plus/*.rds
      moderately_sensitive:
        csv: output/age75plus/*.csv

  skim_selection_age75plus:
    run: r:latest analysis/data_skim.R output/age75plus/data_cohort.rds output/age75plus/skim
    needs:
    - data_selection_age75plus
    outputs:
      moderately_sensitive:
        txt: output/age75plus/skim/*.txt

  ## # # # # # # # # # # # # # # # # # # # 
  ## matching set A 
  ## # # # # # # # # # # # # # # # # # # # 

  match_age75plus_A:
    run: r:latest analysis/match.R age75plus A
    needs:
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/*.rds

  match_report_age75plus_A:
    run: r:latest analysis/match_report.R age75plus A
    needs:
    - data_selection_age75plus
    - match_age75plus_A
    outputs:
      moderately_sensitive:
        csv: output/age75plus/A/report/*.csv
        png: output/age75plus/A/report/*.png

  ## ### Overall models (''all'') 

  km_age75plus_A_all_covidemergency:
    run: r:latest analysis/km.R age75plus A all covidemergency
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/all/covidemergency/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/all/covidemergency/*.png

  km_age75plus_A_all_covidadmitted:
    run: r:latest analysis/km.R age75plus A all covidadmitted
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/all/covidadmitted/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/all/covidadmitted/*.png

  km_age75plus_A_all_covidcritcare:
    run: r:latest analysis/km.R age75plus A all covidcritcare
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/all/covidcritcare/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/all/covidcritcare/*.png

  km_age75plus_A_all_coviddeath:
    run: r:latest analysis/km.R age75plus A all coviddeath
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/all/coviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/all/coviddeath/*.png

  km_age75plus_A_all_noncoviddeath:
    run: r:latest analysis/km.R age75plus A all noncoviddeath
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/all/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/all/noncoviddeath/*.png

  km_age75plus_A_all_fracture:
    run: r:latest analysis/km.R age75plus A all fracture
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/all/fracture/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/all/fracture/*.png

  km_age75plus_A_all_pericarditis:
    run: r:latest analysis/km.R age75plus A all pericarditis
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/all/pericarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/all/pericarditis/*.png

  km_age75plus_A_all_myocarditis:
    run: r:latest analysis/km.R age75plus A all myocarditis
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/all/myocarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/all/myocarditis/*.png

  ## ### Models by age-band (''ageband'') 

  km_age75plus_A_ageband_covidemergency:
    run: r:latest analysis/km.R age75plus A ageband covidemergency
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/ageband/covidemergency/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/ageband/covidemergency/*.png

  km_age75plus_A_ageband_covidadmitted:
    run: r:latest analysis/km.R age75plus A ageband covidadmitted
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/ageband/covidadmitted/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/ageband/covidadmitted/*.png

  km_age75plus_A_ageband_covidcritcare:
    run: r:latest analysis/km.R age75plus A ageband covidcritcare
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/ageband/covidcritcare/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/ageband/covidcritcare/*.png

  km_age75plus_A_ageband_coviddeath:
    run: r:latest analysis/km.R age75plus A ageband coviddeath
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/ageband/coviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/ageband/coviddeath/*.png

  km_age75plus_A_ageband_noncoviddeath:
    run: r:latest analysis/km.R age75plus A ageband noncoviddeath
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/ageband/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/ageband/noncoviddeath/*.png

  km_age75plus_A_ageband_fracture:
    run: r:latest analysis/km.R age75plus A ageband fracture
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/ageband/fracture/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/ageband/fracture/*.png

  km_age75plus_A_ageband_pericarditis:
    run: r:latest analysis/km.R age75plus A ageband pericarditis
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/ageband/pericarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/ageband/pericarditis/*.png

  km_age75plus_A_ageband_myocarditis:
    run: r:latest analysis/km.R age75plus A ageband myocarditis
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/ageband/myocarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/ageband/myocarditis/*.png

  ## ### Models by clinically vulnerable group (''cv'') 

  km_age75plus_A_cv_covidemergency:
    run: r:latest analysis/km.R age75plus A cv covidemergency
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/cv/covidemergency/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/cv/covidemergency/*.png

  km_age75plus_A_cv_covidadmitted:
    run: r:latest analysis/km.R age75plus A cv covidadmitted
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/cv/covidadmitted/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/cv/covidadmitted/*.png

  km_age75plus_A_cv_covidcritcare:
    run: r:latest analysis/km.R age75plus A cv covidcritcare
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/cv/covidcritcare/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/cv/covidcritcare/*.png

  km_age75plus_A_cv_coviddeath:
    run: r:latest analysis/km.R age75plus A cv coviddeath
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/cv/coviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/cv/coviddeath/*.png

  km_age75plus_A_cv_noncoviddeath:
    run: r:latest analysis/km.R age75plus A cv noncoviddeath
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/cv/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/cv/noncoviddeath/*.png

  km_age75plus_A_cv_fracture:
    run: r:latest analysis/km.R age75plus A cv fracture
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/cv/fracture/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/cv/fracture/*.png

  km_age75plus_A_cv_pericarditis:
    run: r:latest analysis/km.R age75plus A cv pericarditis
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/cv/pericarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/cv/pericarditis/*.png

  km_age75plus_A_cv_myocarditis:
    run: r:latest analysis/km.R age75plus A cv myocarditis
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/cv/myocarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/cv/myocarditis/*.png

  ## ### Models by vax history (''vax_previous_group'') 

  km_age75plus_A_vax_previous_group_covidemergency:
    run: r:latest analysis/km.R age75plus A vax_previous_group covidemergency
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/vax_previous_group/covidemergency/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/vax_previous_group/covidemergency/*.png

  km_age75plus_A_vax_previous_group_covidadmitted:
    run: r:latest analysis/km.R age75plus A vax_previous_group covidadmitted
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/vax_previous_group/covidadmitted/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/vax_previous_group/covidadmitted/*.png

  km_age75plus_A_vax_previous_group_covidcritcare:
    run: r:latest analysis/km.R age75plus A vax_previous_group covidcritcare
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/vax_previous_group/covidcritcare/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/vax_previous_group/covidcritcare/*.png

  km_age75plus_A_vax_previous_group_coviddeath:
    run: r:latest analysis/km.R age75plus A vax_previous_group coviddeath
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/vax_previous_group/coviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/vax_previous_group/coviddeath/*.png

  km_age75plus_A_vax_previous_group_noncoviddeath:
    run: r:latest analysis/km.R age75plus A vax_previous_group noncoviddeath
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/vax_previous_group/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/vax_previous_group/noncoviddeath/*.png

  km_age75plus_A_vax_previous_group_fracture:
    run: r:latest analysis/km.R age75plus A vax_previous_group fracture
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/vax_previous_group/fracture/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/vax_previous_group/fracture/*.png

  km_age75plus_A_vax_previous_group_pericarditis:
    run: r:latest analysis/km.R age75plus A vax_previous_group pericarditis
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/vax_previous_group/pericarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/vax_previous_group/pericarditis/*.png

  km_age75plus_A_vax_previous_group_myocarditis:
    run: r:latest analysis/km.R age75plus A vax_previous_group myocarditis
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/km/vax_previous_group/myocarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/A/km/vax_previous_group/myocarditis/*.png

  eventcounts_age75plus_A:
    run: r:latest analysis/eventcounts.R age75plus A
    needs:
    - match_age75plus_A
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/A/eventcounts/*.rds

  ## # # # # # # # # # # # # # # # # # # # 
  ## matching set B 
  ## # # # # # # # # # # # # # # # # # # # 

  match_age75plus_B:
    run: r:latest analysis/match.R age75plus B
    needs:
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/*.rds

  match_report_age75plus_B:
    run: r:latest analysis/match_report.R age75plus B
    needs:
    - data_selection_age75plus
    - match_age75plus_B
    outputs:
      moderately_sensitive:
        csv: output/age75plus/B/report/*.csv
        png: output/age75plus/B/report/*.png

  ## ### Overall models (''all'') 

  km_age75plus_B_all_covidemergency:
    run: r:latest analysis/km.R age75plus B all covidemergency
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/all/covidemergency/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/all/covidemergency/*.png

  km_age75plus_B_all_covidadmitted:
    run: r:latest analysis/km.R age75plus B all covidadmitted
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/all/covidadmitted/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/all/covidadmitted/*.png

  km_age75plus_B_all_covidcritcare:
    run: r:latest analysis/km.R age75plus B all covidcritcare
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/all/covidcritcare/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/all/covidcritcare/*.png

  km_age75plus_B_all_coviddeath:
    run: r:latest analysis/km.R age75plus B all coviddeath
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/all/coviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/all/coviddeath/*.png

  km_age75plus_B_all_noncoviddeath:
    run: r:latest analysis/km.R age75plus B all noncoviddeath
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/all/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/all/noncoviddeath/*.png

  km_age75plus_B_all_fracture:
    run: r:latest analysis/km.R age75plus B all fracture
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/all/fracture/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/all/fracture/*.png

  km_age75plus_B_all_pericarditis:
    run: r:latest analysis/km.R age75plus B all pericarditis
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/all/pericarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/all/pericarditis/*.png

  km_age75plus_B_all_myocarditis:
    run: r:latest analysis/km.R age75plus B all myocarditis
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/all/myocarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/all/myocarditis/*.png

  ## ### Models by age-band (''ageband'') 

  km_age75plus_B_ageband_covidemergency:
    run: r:latest analysis/km.R age75plus B ageband covidemergency
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/ageband/covidemergency/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/ageband/covidemergency/*.png

  km_age75plus_B_ageband_covidadmitted:
    run: r:latest analysis/km.R age75plus B ageband covidadmitted
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/ageband/covidadmitted/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/ageband/covidadmitted/*.png

  km_age75plus_B_ageband_covidcritcare:
    run: r:latest analysis/km.R age75plus B ageband covidcritcare
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/ageband/covidcritcare/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/ageband/covidcritcare/*.png

  km_age75plus_B_ageband_coviddeath:
    run: r:latest analysis/km.R age75plus B ageband coviddeath
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/ageband/coviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/ageband/coviddeath/*.png

  km_age75plus_B_ageband_noncoviddeath:
    run: r:latest analysis/km.R age75plus B ageband noncoviddeath
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/ageband/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/ageband/noncoviddeath/*.png

  km_age75plus_B_ageband_fracture:
    run: r:latest analysis/km.R age75plus B ageband fracture
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/ageband/fracture/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/ageband/fracture/*.png

  km_age75plus_B_ageband_pericarditis:
    run: r:latest analysis/km.R age75plus B ageband pericarditis
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/ageband/pericarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/ageband/pericarditis/*.png

  km_age75plus_B_ageband_myocarditis:
    run: r:latest analysis/km.R age75plus B ageband myocarditis
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/ageband/myocarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/ageband/myocarditis/*.png

  ## ### Models by clinically vulnerable group (''cv'') 

  km_age75plus_B_cv_covidemergency:
    run: r:latest analysis/km.R age75plus B cv covidemergency
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/cv/covidemergency/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/cv/covidemergency/*.png

  km_age75plus_B_cv_covidadmitted:
    run: r:latest analysis/km.R age75plus B cv covidadmitted
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/cv/covidadmitted/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/cv/covidadmitted/*.png

  km_age75plus_B_cv_covidcritcare:
    run: r:latest analysis/km.R age75plus B cv covidcritcare
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/cv/covidcritcare/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/cv/covidcritcare/*.png

  km_age75plus_B_cv_coviddeath:
    run: r:latest analysis/km.R age75plus B cv coviddeath
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/cv/coviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/cv/coviddeath/*.png

  km_age75plus_B_cv_noncoviddeath:
    run: r:latest analysis/km.R age75plus B cv noncoviddeath
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/cv/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/cv/noncoviddeath/*.png

  km_age75plus_B_cv_fracture:
    run: r:latest analysis/km.R age75plus B cv fracture
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/cv/fracture/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/cv/fracture/*.png

  km_age75plus_B_cv_pericarditis:
    run: r:latest analysis/km.R age75plus B cv pericarditis
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/cv/pericarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/cv/pericarditis/*.png

  km_age75plus_B_cv_myocarditis:
    run: r:latest analysis/km.R age75plus B cv myocarditis
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/cv/myocarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/cv/myocarditis/*.png

  ## ### Models by vax history (''vax_previous_group'') 

  km_age75plus_B_vax_previous_group_covidemergency:
    run: r:latest analysis/km.R age75plus B vax_previous_group covidemergency
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/vax_previous_group/covidemergency/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/vax_previous_group/covidemergency/*.png

  km_age75plus_B_vax_previous_group_covidadmitted:
    run: r:latest analysis/km.R age75plus B vax_previous_group covidadmitted
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/vax_previous_group/covidadmitted/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/vax_previous_group/covidadmitted/*.png

  km_age75plus_B_vax_previous_group_covidcritcare:
    run: r:latest analysis/km.R age75plus B vax_previous_group covidcritcare
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/vax_previous_group/covidcritcare/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/vax_previous_group/covidcritcare/*.png

  km_age75plus_B_vax_previous_group_coviddeath:
    run: r:latest analysis/km.R age75plus B vax_previous_group coviddeath
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/vax_previous_group/coviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/vax_previous_group/coviddeath/*.png

  km_age75plus_B_vax_previous_group_noncoviddeath:
    run: r:latest analysis/km.R age75plus B vax_previous_group noncoviddeath
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/vax_previous_group/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/vax_previous_group/noncoviddeath/*.png

  km_age75plus_B_vax_previous_group_fracture:
    run: r:latest analysis/km.R age75plus B vax_previous_group fracture
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/vax_previous_group/fracture/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/vax_previous_group/fracture/*.png

  km_age75plus_B_vax_previous_group_pericarditis:
    run: r:latest analysis/km.R age75plus B vax_previous_group pericarditis
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/vax_previous_group/pericarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/vax_previous_group/pericarditis/*.png

  km_age75plus_B_vax_previous_group_myocarditis:
    run: r:latest analysis/km.R age75plus B vax_previous_group myocarditis
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/km/vax_previous_group/myocarditis/*.rds
      moderately_sensitive:
        png: output/age75plus/B/km/vax_previous_group/myocarditis/*.png

  eventcounts_age75plus_B:
    run: r:latest analysis/eventcounts.R age75plus B
    needs:
    - match_age75plus_B
    - data_selection_age75plus
    outputs:
      highly_sensitive:
        rds: output/age75plus/B/eventcounts/*.rds

  ## # # # # # # # # # # # # # # # # # # # 
  ## Cohort: cv 
  ## # # # # # # # # # # # # # # # # # # # 

  data_selection_cv:
    run: r:latest analysis/data_selection.R cv
    needs:
    - data_process
    outputs:
      highly_sensitive:
        rds: output/cv/*.rds
      moderately_sensitive:
        csv: output/cv/*.csv

  skim_selection_cv:
    run: r:latest analysis/data_skim.R output/cv/data_cohort.rds output/cv/skim
    needs:
    - data_selection_cv
    outputs:
      moderately_sensitive:
        txt: output/cv/skim/*.txt

  ## # # # # # # # # # # # # # # # # # # # 
  ## matching set A 
  ## # # # # # # # # # # # # # # # # # # # 

  match_cv_A:
    run: r:latest analysis/match.R cv A
    needs:
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/*.rds

  match_report_cv_A:
    run: r:latest analysis/match_report.R cv A
    needs:
    - data_selection_cv
    - match_cv_A
    outputs:
      moderately_sensitive:
        csv: output/cv/A/report/*.csv
        png: output/cv/A/report/*.png

  ## ### Overall models (''all'') 

  km_cv_A_all_covidemergency:
    run: r:latest analysis/km.R cv A all covidemergency
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/all/covidemergency/*.rds
      moderately_sensitive:
        png: output/cv/A/km/all/covidemergency/*.png

  km_cv_A_all_covidadmitted:
    run: r:latest analysis/km.R cv A all covidadmitted
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/all/covidadmitted/*.rds
      moderately_sensitive:
        png: output/cv/A/km/all/covidadmitted/*.png

  km_cv_A_all_covidcritcare:
    run: r:latest analysis/km.R cv A all covidcritcare
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/all/covidcritcare/*.rds
      moderately_sensitive:
        png: output/cv/A/km/all/covidcritcare/*.png

  km_cv_A_all_coviddeath:
    run: r:latest analysis/km.R cv A all coviddeath
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/all/coviddeath/*.rds
      moderately_sensitive:
        png: output/cv/A/km/all/coviddeath/*.png

  km_cv_A_all_noncoviddeath:
    run: r:latest analysis/km.R cv A all noncoviddeath
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/all/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/cv/A/km/all/noncoviddeath/*.png

  km_cv_A_all_fracture:
    run: r:latest analysis/km.R cv A all fracture
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/all/fracture/*.rds
      moderately_sensitive:
        png: output/cv/A/km/all/fracture/*.png

  km_cv_A_all_pericarditis:
    run: r:latest analysis/km.R cv A all pericarditis
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/all/pericarditis/*.rds
      moderately_sensitive:
        png: output/cv/A/km/all/pericarditis/*.png

  km_cv_A_all_myocarditis:
    run: r:latest analysis/km.R cv A all myocarditis
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/all/myocarditis/*.rds
      moderately_sensitive:
        png: output/cv/A/km/all/myocarditis/*.png

  ## ### Models by age-band (''ageband'') 

  km_cv_A_ageband_covidemergency:
    run: r:latest analysis/km.R cv A ageband covidemergency
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/ageband/covidemergency/*.rds
      moderately_sensitive:
        png: output/cv/A/km/ageband/covidemergency/*.png

  km_cv_A_ageband_covidadmitted:
    run: r:latest analysis/km.R cv A ageband covidadmitted
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/ageband/covidadmitted/*.rds
      moderately_sensitive:
        png: output/cv/A/km/ageband/covidadmitted/*.png

  km_cv_A_ageband_covidcritcare:
    run: r:latest analysis/km.R cv A ageband covidcritcare
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/ageband/covidcritcare/*.rds
      moderately_sensitive:
        png: output/cv/A/km/ageband/covidcritcare/*.png

  km_cv_A_ageband_coviddeath:
    run: r:latest analysis/km.R cv A ageband coviddeath
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/ageband/coviddeath/*.rds
      moderately_sensitive:
        png: output/cv/A/km/ageband/coviddeath/*.png

  km_cv_A_ageband_noncoviddeath:
    run: r:latest analysis/km.R cv A ageband noncoviddeath
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/ageband/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/cv/A/km/ageband/noncoviddeath/*.png

  km_cv_A_ageband_fracture:
    run: r:latest analysis/km.R cv A ageband fracture
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/ageband/fracture/*.rds
      moderately_sensitive:
        png: output/cv/A/km/ageband/fracture/*.png

  km_cv_A_ageband_pericarditis:
    run: r:latest analysis/km.R cv A ageband pericarditis
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/ageband/pericarditis/*.rds
      moderately_sensitive:
        png: output/cv/A/km/ageband/pericarditis/*.png

  km_cv_A_ageband_myocarditis:
    run: r:latest analysis/km.R cv A ageband myocarditis
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/ageband/myocarditis/*.rds
      moderately_sensitive:
        png: output/cv/A/km/ageband/myocarditis/*.png

  ## ### Models by vax history (''vax_previous_group'') 

  km_cv_A_vax_previous_group_covidemergency:
    run: r:latest analysis/km.R cv A vax_previous_group covidemergency
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/vax_previous_group/covidemergency/*.rds
      moderately_sensitive:
        png: output/cv/A/km/vax_previous_group/covidemergency/*.png

  km_cv_A_vax_previous_group_covidadmitted:
    run: r:latest analysis/km.R cv A vax_previous_group covidadmitted
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/vax_previous_group/covidadmitted/*.rds
      moderately_sensitive:
        png: output/cv/A/km/vax_previous_group/covidadmitted/*.png

  km_cv_A_vax_previous_group_covidcritcare:
    run: r:latest analysis/km.R cv A vax_previous_group covidcritcare
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/vax_previous_group/covidcritcare/*.rds
      moderately_sensitive:
        png: output/cv/A/km/vax_previous_group/covidcritcare/*.png

  km_cv_A_vax_previous_group_coviddeath:
    run: r:latest analysis/km.R cv A vax_previous_group coviddeath
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/vax_previous_group/coviddeath/*.rds
      moderately_sensitive:
        png: output/cv/A/km/vax_previous_group/coviddeath/*.png

  km_cv_A_vax_previous_group_noncoviddeath:
    run: r:latest analysis/km.R cv A vax_previous_group noncoviddeath
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/vax_previous_group/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/cv/A/km/vax_previous_group/noncoviddeath/*.png

  km_cv_A_vax_previous_group_fracture:
    run: r:latest analysis/km.R cv A vax_previous_group fracture
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/vax_previous_group/fracture/*.rds
      moderately_sensitive:
        png: output/cv/A/km/vax_previous_group/fracture/*.png

  km_cv_A_vax_previous_group_pericarditis:
    run: r:latest analysis/km.R cv A vax_previous_group pericarditis
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/vax_previous_group/pericarditis/*.rds
      moderately_sensitive:
        png: output/cv/A/km/vax_previous_group/pericarditis/*.png

  km_cv_A_vax_previous_group_myocarditis:
    run: r:latest analysis/km.R cv A vax_previous_group myocarditis
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/km/vax_previous_group/myocarditis/*.rds
      moderately_sensitive:
        png: output/cv/A/km/vax_previous_group/myocarditis/*.png

  eventcounts_cv_A:
    run: r:latest analysis/eventcounts.R cv A
    needs:
    - match_cv_A
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/A/eventcounts/*.rds

  ## # # # # # # # # # # # # # # # # # # # 
  ## matching set B 
  ## # # # # # # # # # # # # # # # # # # # 

  match_cv_B:
    run: r:latest analysis/match.R cv B
    needs:
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/*.rds

  match_report_cv_B:
    run: r:latest analysis/match_report.R cv B
    needs:
    - data_selection_cv
    - match_cv_B
    outputs:
      moderately_sensitive:
        csv: output/cv/B/report/*.csv
        png: output/cv/B/report/*.png

  ## ### Overall models (''all'') 

  km_cv_B_all_covidemergency:
    run: r:latest analysis/km.R cv B all covidemergency
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/all/covidemergency/*.rds
      moderately_sensitive:
        png: output/cv/B/km/all/covidemergency/*.png

  km_cv_B_all_covidadmitted:
    run: r:latest analysis/km.R cv B all covidadmitted
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/all/covidadmitted/*.rds
      moderately_sensitive:
        png: output/cv/B/km/all/covidadmitted/*.png

  km_cv_B_all_covidcritcare:
    run: r:latest analysis/km.R cv B all covidcritcare
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/all/covidcritcare/*.rds
      moderately_sensitive:
        png: output/cv/B/km/all/covidcritcare/*.png

  km_cv_B_all_coviddeath:
    run: r:latest analysis/km.R cv B all coviddeath
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/all/coviddeath/*.rds
      moderately_sensitive:
        png: output/cv/B/km/all/coviddeath/*.png

  km_cv_B_all_noncoviddeath:
    run: r:latest analysis/km.R cv B all noncoviddeath
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/all/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/cv/B/km/all/noncoviddeath/*.png

  km_cv_B_all_fracture:
    run: r:latest analysis/km.R cv B all fracture
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/all/fracture/*.rds
      moderately_sensitive:
        png: output/cv/B/km/all/fracture/*.png

  km_cv_B_all_pericarditis:
    run: r:latest analysis/km.R cv B all pericarditis
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/all/pericarditis/*.rds
      moderately_sensitive:
        png: output/cv/B/km/all/pericarditis/*.png

  km_cv_B_all_myocarditis:
    run: r:latest analysis/km.R cv B all myocarditis
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/all/myocarditis/*.rds
      moderately_sensitive:
        png: output/cv/B/km/all/myocarditis/*.png

  ## ### Models by age-band (''ageband'') 

  km_cv_B_ageband_covidemergency:
    run: r:latest analysis/km.R cv B ageband covidemergency
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/ageband/covidemergency/*.rds
      moderately_sensitive:
        png: output/cv/B/km/ageband/covidemergency/*.png

  km_cv_B_ageband_covidadmitted:
    run: r:latest analysis/km.R cv B ageband covidadmitted
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/ageband/covidadmitted/*.rds
      moderately_sensitive:
        png: output/cv/B/km/ageband/covidadmitted/*.png

  km_cv_B_ageband_covidcritcare:
    run: r:latest analysis/km.R cv B ageband covidcritcare
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/ageband/covidcritcare/*.rds
      moderately_sensitive:
        png: output/cv/B/km/ageband/covidcritcare/*.png

  km_cv_B_ageband_coviddeath:
    run: r:latest analysis/km.R cv B ageband coviddeath
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/ageband/coviddeath/*.rds
      moderately_sensitive:
        png: output/cv/B/km/ageband/coviddeath/*.png

  km_cv_B_ageband_noncoviddeath:
    run: r:latest analysis/km.R cv B ageband noncoviddeath
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/ageband/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/cv/B/km/ageband/noncoviddeath/*.png

  km_cv_B_ageband_fracture:
    run: r:latest analysis/km.R cv B ageband fracture
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/ageband/fracture/*.rds
      moderately_sensitive:
        png: output/cv/B/km/ageband/fracture/*.png

  km_cv_B_ageband_pericarditis:
    run: r:latest analysis/km.R cv B ageband pericarditis
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/ageband/pericarditis/*.rds
      moderately_sensitive:
        png: output/cv/B/km/ageband/pericarditis/*.png

  km_cv_B_ageband_myocarditis:
    run: r:latest analysis/km.R cv B ageband myocarditis
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/ageband/myocarditis/*.rds
      moderately_sensitive:
        png: output/cv/B/km/ageband/myocarditis/*.png

  ## ### Models by vax history (''vax_previous_group'') 

  km_cv_B_vax_previous_group_covidemergency:
    run: r:latest analysis/km.R cv B vax_previous_group covidemergency
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/vax_previous_group/covidemergency/*.rds
      moderately_sensitive:
        png: output/cv/B/km/vax_previous_group/covidemergency/*.png

  km_cv_B_vax_previous_group_covidadmitted:
    run: r:latest analysis/km.R cv B vax_previous_group covidadmitted
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/vax_previous_group/covidadmitted/*.rds
      moderately_sensitive:
        png: output/cv/B/km/vax_previous_group/covidadmitted/*.png

  km_cv_B_vax_previous_group_covidcritcare:
    run: r:latest analysis/km.R cv B vax_previous_group covidcritcare
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/vax_previous_group/covidcritcare/*.rds
      moderately_sensitive:
        png: output/cv/B/km/vax_previous_group/covidcritcare/*.png

  km_cv_B_vax_previous_group_coviddeath:
    run: r:latest analysis/km.R cv B vax_previous_group coviddeath
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/vax_previous_group/coviddeath/*.rds
      moderately_sensitive:
        png: output/cv/B/km/vax_previous_group/coviddeath/*.png

  km_cv_B_vax_previous_group_noncoviddeath:
    run: r:latest analysis/km.R cv B vax_previous_group noncoviddeath
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/vax_previous_group/noncoviddeath/*.rds
      moderately_sensitive:
        png: output/cv/B/km/vax_previous_group/noncoviddeath/*.png

  km_cv_B_vax_previous_group_fracture:
    run: r:latest analysis/km.R cv B vax_previous_group fracture
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/vax_previous_group/fracture/*.rds
      moderately_sensitive:
        png: output/cv/B/km/vax_previous_group/fracture/*.png

  km_cv_B_vax_previous_group_pericarditis:
    run: r:latest analysis/km.R cv B vax_previous_group pericarditis
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/vax_previous_group/pericarditis/*.rds
      moderately_sensitive:
        png: output/cv/B/km/vax_previous_group/pericarditis/*.png

  km_cv_B_vax_previous_group_myocarditis:
    run: r:latest analysis/km.R cv B vax_previous_group myocarditis
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/km/vax_previous_group/myocarditis/*.rds
      moderately_sensitive:
        png: output/cv/B/km/vax_previous_group/myocarditis/*.png

  eventcounts_cv_B:
    run: r:latest analysis/eventcounts.R cv B
    needs:
    - match_cv_B
    - data_selection_cv
    outputs:
      highly_sensitive:
        rds: output/cv/B/eventcounts/*.rds

  ## # # # # # # # # # # # # # # # # # # # 
  ## Combine estimates across cohorts, matchsets, outcomes and subgroups 
  ## # # # # # # # # # # # # # # # # # # # 

  contrasts_combine_age75plus_A:
    run: r:latest analysis/contrasts_combine.R age75plus A
    needs:
    - km_age75plus_A_all_covidemergency
    - km_age75plus_A_all_covidadmitted
    - km_age75plus_A_all_covidcritcare
    - km_age75plus_A_all_coviddeath
    - km_age75plus_A_all_noncoviddeath
    - km_age75plus_A_all_fracture
    - km_age75plus_A_all_pericarditis
    - km_age75plus_A_all_myocarditis
    - km_age75plus_A_ageband_covidemergency
    - km_age75plus_A_ageband_covidadmitted
    - km_age75plus_A_ageband_covidcritcare
    - km_age75plus_A_ageband_coviddeath
    - km_age75plus_A_ageband_noncoviddeath
    - km_age75plus_A_ageband_fracture
    - km_age75plus_A_ageband_pericarditis
    - km_age75plus_A_ageband_myocarditis
    - km_age75plus_A_cv_covidemergency
    - km_age75plus_A_cv_covidadmitted
    - km_age75plus_A_cv_covidcritcare
    - km_age75plus_A_cv_coviddeath
    - km_age75plus_A_cv_noncoviddeath
    - km_age75plus_A_cv_fracture
    - km_age75plus_A_cv_pericarditis
    - km_age75plus_A_cv_myocarditis
    - km_age75plus_A_vax_previous_group_covidemergency
    - km_age75plus_A_vax_previous_group_covidadmitted
    - km_age75plus_A_vax_previous_group_covidcritcare
    - km_age75plus_A_vax_previous_group_coviddeath
    - km_age75plus_A_vax_previous_group_noncoviddeath
    - km_age75plus_A_vax_previous_group_fracture
    - km_age75plus_A_vax_previous_group_pericarditis
    - km_age75plus_A_vax_previous_group_myocarditis
    - eventcounts_age75plus_A
    outputs:
      moderately_sensitive:
        csv: output/age75plus/A/combined/*.csv
        png: output/age75plus/A/combined/plots/*.png

  contrasts_combine_age75plus_B:
    run: r:latest analysis/contrasts_combine.R age75plus B
    needs:
    - km_age75plus_B_all_covidemergency
    - km_age75plus_B_all_covidadmitted
    - km_age75plus_B_all_covidcritcare
    - km_age75plus_B_all_coviddeath
    - km_age75plus_B_all_noncoviddeath
    - km_age75plus_B_all_fracture
    - km_age75plus_B_all_pericarditis
    - km_age75plus_B_all_myocarditis
    - km_age75plus_B_ageband_covidemergency
    - km_age75plus_B_ageband_covidadmitted
    - km_age75plus_B_ageband_covidcritcare
    - km_age75plus_B_ageband_coviddeath
    - km_age75plus_B_ageband_noncoviddeath
    - km_age75plus_B_ageband_fracture
    - km_age75plus_B_ageband_pericarditis
    - km_age75plus_B_ageband_myocarditis
    - km_age75plus_B_cv_covidemergency
    - km_age75plus_B_cv_covidadmitted
    - km_age75plus_B_cv_covidcritcare
    - km_age75plus_B_cv_coviddeath
    - km_age75plus_B_cv_noncoviddeath
    - km_age75plus_B_cv_fracture
    - km_age75plus_B_cv_pericarditis
    - km_age75plus_B_cv_myocarditis
    - km_age75plus_B_vax_previous_group_covidemergency
    - km_age75plus_B_vax_previous_group_covidadmitted
    - km_age75plus_B_vax_previous_group_covidcritcare
    - km_age75plus_B_vax_previous_group_coviddeath
    - km_age75plus_B_vax_previous_group_noncoviddeath
    - km_age75plus_B_vax_previous_group_fracture
    - km_age75plus_B_vax_previous_group_pericarditis
    - km_age75plus_B_vax_previous_group_myocarditis
    - eventcounts_age75plus_B
    outputs:
      moderately_sensitive:
        csv: output/age75plus/B/combined/*.csv
        png: output/age75plus/B/combined/plots/*.png

  contrasts_combine_cv_A:
    run: r:latest analysis/contrasts_combine.R cv A
    needs:
    - km_cv_A_all_covidemergency
    - km_cv_A_all_covidadmitted
    - km_cv_A_all_covidcritcare
    - km_cv_A_all_coviddeath
    - km_cv_A_all_noncoviddeath
    - km_cv_A_all_fracture
    - km_cv_A_all_pericarditis
    - km_cv_A_all_myocarditis
    - km_cv_A_ageband_covidemergency
    - km_cv_A_ageband_covidadmitted
    - km_cv_A_ageband_covidcritcare
    - km_cv_A_ageband_coviddeath
    - km_cv_A_ageband_noncoviddeath
    - km_cv_A_ageband_fracture
    - km_cv_A_ageband_pericarditis
    - km_cv_A_ageband_myocarditis
    - km_cv_A_vax_previous_group_covidemergency
    - km_cv_A_vax_previous_group_covidadmitted
    - km_cv_A_vax_previous_group_covidcritcare
    - km_cv_A_vax_previous_group_coviddeath
    - km_cv_A_vax_previous_group_noncoviddeath
    - km_cv_A_vax_previous_group_fracture
    - km_cv_A_vax_previous_group_pericarditis
    - km_cv_A_vax_previous_group_myocarditis
    - eventcounts_cv_A
    outputs:
      moderately_sensitive:
        csv: output/cv/A/combined/*.csv
        png: output/cv/A/combined/plots/*.png

  contrasts_combine_cv_B:
    run: r:latest analysis/contrasts_combine.R cv B
    needs:
    - km_cv_B_all_covidemergency
    - km_cv_B_all_covidadmitted
    - km_cv_B_all_covidcritcare
    - km_cv_B_all_coviddeath
    - km_cv_B_all_noncoviddeath
    - km_cv_B_all_fracture
    - km_cv_B_all_pericarditis
    - km_cv_B_all_myocarditis
    - km_cv_B_ageband_covidemergency
    - km_cv_B_ageband_covidadmitted
    - km_cv_B_ageband_covidcritcare
    - km_cv_B_ageband_coviddeath
    - km_cv_B_ageband_noncoviddeath
    - km_cv_B_ageband_fracture
    - km_cv_B_ageband_pericarditis
    - km_cv_B_ageband_myocarditis
    - km_cv_B_vax_previous_group_covidemergency
    - km_cv_B_vax_previous_group_covidadmitted
    - km_cv_B_vax_previous_group_covidcritcare
    - km_cv_B_vax_previous_group_coviddeath
    - km_cv_B_vax_previous_group_noncoviddeath
    - km_cv_B_vax_previous_group_fracture
    - km_cv_B_vax_previous_group_pericarditis
    - km_cv_B_vax_previous_group_myocarditis
    - eventcounts_cv_B
    outputs:
      moderately_sensitive:
        csv: output/cv/B/combined/*.csv
        png: output/cv/B/combined/plots/*.png

  ## # # # # # # # # # # # # # # # # # # # 
  ## Files for release 
  ## # # # # # # # # # # # # # # # # # # # 

  release_objects:
    run: r:latest analysis/release_objects.R
    needs:
    - data_selection_age75plus
    - match_report_age75plus_A
    - match_report_age75plus_B
    - contrasts_combine_age75plus_A
    - contrasts_combine_age75plus_B
    - data_selection_cv
    - match_report_cv_A
    - match_report_cv_B
    - contrasts_combine_cv_A
    - contrasts_combine_cv_B
    outputs:
      moderately_sensitive:
        releaselist: output/files-for-release.txt
        command: output/osrelease-command.txt
        csv: output/release-objects/*/*.csv

  ## # # # # # # # # # # # # # # # # # # # 
  ## End 
  ## # # # # # # # # # # # # # # # # # # # 

